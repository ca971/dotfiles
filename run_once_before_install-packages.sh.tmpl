#!/bin/bash

# --- 1. D√©tection de l'OS ---
OS_TYPE="{{ .chezmoi.os }}"
echo "üîç OS d√©tect√© : $OS_TYPE"

# --- 2. Installation pour macOS ---
{{ if eq .chezmoi.os "darwin" -}}

# V√©rification des Command Line Tools
if ! xcode-select -p &> /dev/null; then
    echo "üõ†Ô∏è  Xcode Command Line Tools non d√©tect√©s."
    echo "üöÄ Lancement de l'installateur..."
    xcode-select --install

    echo "‚è≥ Attente de la fin de l'installation..."
    echo "üìå Veuillez cliquer sur 'Installer' dans la fen√™tre qui vient de s'ouvrir."
    
    # Boucle d'attente : v√©rifie toutes les 5 secondes si xcode-select est fonctionnel
    until xcode-select -p &> /dev/null; do
        sleep 5
        echo "   ... en attente de la fin de l'installation (cliquez sur 'Installer' si ce n'est pas fait) ..."
    done

    echo "‚úÖ Xcode Command Line Tools install√©s !"
fi

# Suite de l'installation (Homebrew)
if ! command -v brew &> /dev/null; then
    echo "üç∫ Installation de Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # Configurer brew dans le shell actuel
    if [[ -d /opt/homebrew/bin ]]; then
        eval "$(/opt/homebrew/bin/brew shellenv)"
    else
        eval "$(/usr/local/bin/brew shellenv)"
    fi
fi

echo "üì¶ Installation des outils Power User (macOS)..."
brew install eza lsd bat fd ripgrep fzf htop btop duf dfc gping p7zip tldr jq
{{ end -}}

# --- 3. Section Linux ---
{{ if eq .chezmoi.os "linux" -}}
# ... (votre section Linux habituelle)
{{ end -}}

echo "‚ú® Configuration termin√©e avec succ√®s !"

